# CadQuery GenAI Service

A self-hosted web application that leverages Google's Gemini API to generate 3D models using CadQuery (Python) from natural language prompts.

## Features
- **Text-to-3D**: Describe a shape or mechanical part, and the system generates the corresponding 3D model.
- **Interactive Viewer**: Preview the generated results immediately in your browser.
- **Iterative Refinement**: Chat with the AI to tweak dimensions, add features, or fix errors.
- **Export**: Download your final design as STL or 3MF for 3D printing.
- **Persistence**: Usage history and models are saved to a local SQLite database.

## Architecture
- **Backend**: Python/FastAPI
    - Uses `cadquery` for geometry generation.
    - Uses `google-generativeai` for code generation.
    - Uses `SQLAlchemy` + `SQLite` for session storage.
- **Frontend**: React (Vite) + Tailwind CSS
    - Uses `react-three-fiber` for 3D visualization (GLTF format).

## Prerequisites
- **Python 3.10+** (Recommended: Use Conda/Mamba if you have trouble installing CadQuery via pip)
- **Node.js 18+**
- **Google Gemini API Key** (Get one from [Google AI Studio](https://aistudio.google.com/))

## Installation & Setup

### 1. Clone & Configure
```bash
git clone <repository-url>
cd cadquery-genai
```

### 2. Backend Setup
**Important**: You must use **Python 3.11 (or 3.10)** as CadQuery pre-compiled binaries are not yet available for Python 3.12+.

We recommend installing Python 3.11 via Homebrew if you are on macOS:
```bash
brew install python@3.11
```

Then leverage standard `pip` and `venv`:

```bash
cd backend
python3.11 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies (including cadquery-ocp binary)
pip install --upgrade pip
pip install cadquery-ocp  # Essential binary dependency
pip install -r requirements.txt
```
*Note: We handle `cadquery-ocp` installation manually to ensure the binary wheel is found.*

### 3. Frontend Setup
```bash
cd frontend
npm install
```

## Running the Application

### 1. Build the Frontend
Bundle the React application so the backend can serve it.
```bash
cd frontend
npm run build
```

### 2. Start the Backend (Serves Everything)
The backend now also hosts the frontend at `http://localhost:8000`.

```bash
# Basic
python main.py --user admin --pass password

# With specific model
python main.py --user admin --pass password --model gemini-1.5-pro
```

### 3. Usage
Open your browser to `http://localhost:8000`. 
- You will see the Landing Page.
- Click "Start Modeling" or "Login" to access the authenticated modeling app.
- Log in with the credentials provided in the command line (e.g., `admin` / `password`).

## Sample Workflow

1.  **Login**: Enter the username and password defined during server start.
2.  **Initial Prompt**:
    > "Design a simple storage box, 100mm wide, 100mm long, and 50mm high, with a 2mm wall thickness."
3.  **Review**: The 3D viewer will show the generated box.
4.  **Refine**:
    > "Add a lid to it that fits on top."
    *or*
    > "Round the vertical edges with a 5mm radius."
5.  **Export**: Click the "Download STL" button to get the file for 3D printing.

## Security Note
**⚠️ Warning**: This application executes Python code generated by an LLM directly on your host machine. It is intended for **local, single-user, self-hosted use only**. Do not expose this server to the public internet without additional security layers (VPN, robust authentication, containerization).
